"""Generates microcontroller board descriptions in SKiDL"""

def generate(args, wizard):
    """ Generates microcontroller board descriptions in SKiDL """

    code = '''
#Generated by Swimibowi - SKiDL Microcontroller Board Wizard
"""Creates Kicad netlist file for a microcontroller board"""
from skidl import Bus, Part, Net, generate_netlist

U1 = Part('RF_Module', '{mcu}', footprint='{mcu_footprint}')

NETS = {{}}
NETS['+VBatt'] = Net('+VBatt')
NETS['+VBus'] = Net('+VBus')
NETS['+3V'] = Net('+3V')
NETS['+3V3'] = Net('+3V3')
NETS['+5V'] = Net('+5V')
NETS['GND'] = Net('GND')

U1['VCC'] += NETS['{mcurail}']
U1['GND'] += NETS['GND']
U1['EN'] += NETS['{mcurail}']
U1['GPIO15'] += NETS['GND']

'''.format(**args)

    if wizard.field('reset'):
        code += '''
NETS['RST'] = Net('RST')
U1['RST'] += NETS['RST']
U1['GPIO16'] += NETS['RST']
'''

    if wizard.field('Reset button'):
        code += '''
SW1 = Part('Switch', 'SW_Push', footprint="Button_Switch_SMD:SW_SPST_B3U-1000P")
SW1[1] += NETS['RST']
SW1[2] += NETS['GND']
'''

    if wizard.field('Flash button'):
        code += '''
SW2 = Part('Switch', 'SW_Push', footprint="Button_Switch_SMD:SW_SPST_B3U-1000P")
SW2[1] += NETS['GPIO15']
SW2[2] += NETS['GND']
'''

    if wizard.field('18b20'):
        code += '''
NETS['VDD'] = Net('VDD')
NETS['VDD'] += NETS['+VBatt']
ONEWIRE = Bus('onewire', NETS['VDD'], NETS['GND'], Net('DQ'))
U1['GPIO2'] += ONEWIRE['DQ']

U2 = Part('Sensor_Temperature', 'DS18B20', footprint="Package_TO_SOT_THT:TO-92_Inline")
U2['VDD'] += ONEWIRE['VDD']
U2['GND'] += ONEWIRE['GND']
U2['DQ'] += ONEWIRE['DQ']

'''
    code += '''generate_netlist()
'''

    return code
